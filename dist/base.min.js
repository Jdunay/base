/* base.js v0.0.5 */ 
!function(a){a.adaptors.backboneAssociatedModel=function(a,b){var c,d,e,f,g,h,i,j;return b&&(b+=".",g=new RegExp("^"+b.replace(/\./g,"\\.")),h=b.length),j=function(b){var c,d,e,g;c=b.split(":"),d=c[0],e=c[1],"change"===d&&e&&(g=a.get(e),g&&g.toJSON&&(g=g.toJSON()),f(e,g))},{init:function(k){b?(i=function(a){var c,d;d={};for(c in a)({}).hasOwnProperty.call(a,c)&&(d[b+c]=a[c]);return d},f=function(b,e){if(!c){d=!0;var f={};f[b]=e,k.set(i(a.changed)),d=!1}},e=function(b,e){d||g.test(b)&&(c=!0,a.set(b.substring(h),e),c=!1)}):(f=function(a,b){c||(d=!0,k.set(a,b),d=!1)},e=function(b,e){d||(c=!0,a.set(b,e),c=!1)}),a.on("all",j),k.on("set",e),k.set(b?i(a.toJSON()):a.toJSON())},teardown:function(b){a.off("all",j),b.off("set",e)}}}}(window.Ractive||require&&require("ractive")),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A={}.hasOwnProperty,B=function(a,b){function c(){this.constructor=a}for(var d in b)A.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},C=[].slice;for(i=window.Base,g=null,d=[],a=function(){function a(){a.__super__.constructor.apply(this,arguments)}return a}(),_.extend(a.prototype,Backbone.Events),a.noConflict=function(){return window.Base=i,a},a.VERSION="0.0.5",a.config={debug:{logModelChanges:!1}},a.View=function(b){function c(b){var d,e,f=this;this.options=null!=b?b:{},null==this.name&&(this.name=this.constructor.name),null==this.attributes&&(this.attributes={}),null==(e=this.attributes)["data-pict-view"]&&(e["data-pict-view"]=this.name.replace(/view/i,"").toLowerCase()),null==this.children&&(this.children=[]),c.__super__.constructor.apply(this,arguments),d=_.extend({relations:this.relations,compute:this.compute},this.stateOptions),this.state=new a.State(this.defaults||this.stateDefaults,d,this),this.state.on("all",function(){var a;return a=1<=arguments.length?C.call(arguments,0):[],f.trigger.apply(f,a)}),this.trigger("init"),this.$el.data("view",this),this._bindEventBubbling(),this._bindSpecialCallbacks(),this._bindSpecialEventMethods()}var e;return B(c,b),c.prototype.moduleType="view",c.prototype.render=function(){return this.trigger("before:render"),this.beforeRender&&this.beforeRender(),this.ractive&&this._initRactive(),this.trigger("render"),this._bindComponents(),this.afterRender&&this.afterRender(),this.trigger("after:render")},c.prototype._bindSpecialEventMethods=function(){var a=this;return this.on("all",function(){var b,c,d,e;return d=arguments[0],b=2<=arguments.length?C.call(arguments,1):[],(c=d.replace(/:([a-z])/gi,function(a,b){return b.toUpperCase()}))?(e=a["on"+c[0].toUpperCase()+c.substring(1)],e?e.apply(a,b):void 0):void 0})},c.prototype._bindSpecialCallbacks=function(){var a,b,c,d,e,f=this;d=this.events,e=[];for(a in d)if(c=d[a],"string"==typeof c)if(b=c.split(":"),b[1])switch(spit[0]){case"set":e.push(this.events[a]=function(){return f.set(b[1].trim(),f.get(b[2].trim()))});break;case"toggle":e.push(this.events[a]=function(){return f.toggle(b[1])});break;default:e.push(void 0)}else e.push(void 0);else e.push(void 0);return e},c.prototype._bindComponents=function(){var b,c,d,e,f,g=this;e=a.components,f=[];for(c in e)d=e[c],b=this.ractive.fragment.items||[],f.push(this.$("x-"+c,b.map(function(a){return a.node})).each(function(a,b){var c,e,f,h,i,j,k,l,m;for(c=$(b),h={},f=[],m=b.attributes,k=0,l=m.length;l>k;k++)e=m[k],i=e.name,j=e.value,0===i.indexOf("x-")&&(h[i.substring(2)]=j);return d.call(g,c,g,h)}));return f},c.prototype._parseObjectGetter=function(a){return a},c.prototype._parseTemplate=function(){},c.prototype._parseDOM=function(){var a,b;return a=function(b){var c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(e={},r=b.attributes,s=[],n=0,p=r.length;p>n;n++){if(c=r[n],i=c.name,m=c.value,d=e[i]=[],/\{\{.*\}\}/.test(m))for(l=d.split(/\{\{|\}\}/),g=o=0,q=l.length;q>o;g=++o)h=l[g],j=g%2,j?(k=_.compact(h.split(/\s+|[\(\)+=-><%\/&!^\|]+/)),d.push({fn:new Function("return "+h),props:k})):d.push(h);s.push({attrs:e,children:function(){var c,d,e,g;for(e=b.chidren,g=[],c=0,d=e.length;d>c;c++)f=e[c],g.push(a(f));return g}()})}return s},b=a(this.el)},c.prototype._initRactive=function(){var b,c,d,e,f,h,i,j,k=this;if(this.options.ractive||this.ractive){c=_.clone(a.filters);for(d in c)i=c[d],i&&i.bind&&(c[d]=i.bind(this));f="src/templates/views/"+$.dasherize(this.name)+".html",e=this.template||pict.templates[f]||"",this.ractive=new Ractive({el:this.el,template:e,data:_.extend(this.toJSON(),{$view:this,$filter:a.filters})});for(d in this)h=this[d],"function"==typeof h&&"_"!==d[0]&&!function(a,b){return k.ractive.on(a,function(a,c){return null==c&&(c=""),"string"!=typeof c&&(c=""),b.apply(k,c.split(":").map(function(a){return $.zepto.deserializeValue(a.trim())}))})}(d,h);b=Ractive.adaptors.backboneAssociatedModel,this.ractive.bind(b(this.state)),this.ractive.bind(b(g.state,"$app")),j=[];for(d in pict)h=pict[d],h instanceof a.Model||h instanceof a.Collection?j.push(this.ractive.bind(b(h,"$pict."+d))):j.push(void 0);return j}},c.prototype._bindEventBubbling=function(){var a,b=this;return a=pict.utils.uncapitalize,this.on("all",function(){var c,d,e,f,g,h,i;if(e=arguments[0],c=2<=arguments.length?C.call(arguments,1):[],b.parent&&0!==e.indexOf("broadcast:")&&(0!==e.indexOf("child:")?(b.parent.trigger.apply(b.parent,["child:"+e].concat(c)),b.name&&b.parent.trigger.apply(b.parent,["child:"+a(name)+":"+e].concat(c))):0===e.indexOf("request:")&&b.parent.trigger.apply(b.parent,[e].concat(c))),b.children&&!/^(child:|request:)/.test(e)){for(h=b.children,i=[],f=0,g=h.length;g>f;f++)d=h[f],0!==e.indexOf("broadcast:")?(d.trigger.apply(d,["broadcast:"+e].concat(c)),b.name?i.push(d.trigger.apply(d,["broadcast:"+a(b.name)+":"+e].concat(c))):i.push(void 0)):i.push(void 0);return i}})},c.prototype.subView=function(a,b){if(!b){if("string"==typeof a)return this.childView(a);b=a,a=null}return b instanceof c||(b=new b(args)),b.__viewName__=a,b.parent=this,this.children.push(b)},c.prototype.insertView=function(a,b){return b||(b=a,a=null),this.subView(b),a?this.$(a).append(b.$el):this.$el.append(b.$el),this},c.prototype.parentView=function(a,b){return this.parentViews(a,b)},c.prototype.findView=function(a){return this.findViews(a,!0)},c.prototype.childView=function(a){return this.childViews(a,!0)},c.prototype.childViews=function(a,b){return this.findViews(a,b,!0)},c.prototype.parentViews=function(a,b){var c,d;if(d=[],a){for(c=this;c=c.parent;)if(c.is&&c.is(a)){if(b)return c;d.push(c)}}else{if(b)return this.parent;d.push(this.parent)}return d},c.prototype.findViews=function(a,b,c){var d,e,f;return f=[],d=void 0,e=function(g){var h,i,j,k,l;for(k=g.children,l=[],i=0,j=k.length;j>i;i++){if(h=k[i],h.is(a)&&(f.push(h),b)){d=h;break}h&&!c?l.push(e(h)):l.push(void 0)}return l},e(this),b?d:f},c.prototype.is=function(a){var b,c,d,e,f,g;if(!a||a===this||this.$el.is(a))return!0;switch(typeof a){case"string":return e=function(a){return a.toLowerCase().replace(/view$/i,"")},d=e(a),c=this.__viewName__,e(this.name||"")===d||e(c||"")===d;case"function":return!!a(this);default:for(b in a)if(g=a[b],f=this.get(b),null==f&&(f=this[b]),g!==f)return!1;return!0}},c.prototype.destroy=function(){return this.ractive&&this.ractive.off&&(this.ractive.teardown(),this.ractive.unbind()),this.state.off(),this.state.stopListening(),this.state.cleanup()&&this.state.cleanup(),this.trigger("destroy"),this.cleanup&&this.cleanup(),this.$el.removeData("view"),this.$el.off(),this.off(),this.undelegateEvents(),this.remove(),this.parent?this.parent.children.splice(this.parent.children.indexOf(this),1):void 0},c.prototype.requestResponse=function(){var a,b,c,d,e,f;for(c=arguments[0],a=2<=arguments.length?C.call(arguments,1):[],d=this,f=[];d=d.parent;){if(b=_.last(d._events["requestResponse:"+c])){e=b.callback.apply(b.ctx,a);break}f.push(void 0)}return f},e=function(){var a,b;return b=arguments[0],a=2<=arguments.length?C.call(arguments,1):[],this.parent.trigger.apply(this.parent,["request:"+b].concat(a))},c.prototype.broadcast=function(){var a,b,c,d,e,f,g;if(c=arguments[0],a=2<=arguments.length?C.call(arguments,1):[],children){for(f=this.children,g=[],d=0,e=f.length;e>d;d++)b=f[d],g.push(b.trigger.apply(b,["broadcast:"+c].concat(a)));return g}},c}(Backbone.View),v=["get","set","toJSON","has","unset","escape","changed","clone","keys","values","pairs","invert","pick","omit","clear"],j=function(b){var c;return null!=(c=a.View.prototype)[b]?(c=a.View.prototype)[b]:c[b]=function(){var a;return a=1<=arguments.length?C.call(arguments,0):[],this.state[b].apply(this.state,a)}},l=0,p=v.length;p>l;l++)h=v[l],j(h);for(a.App=function(a){function b(){g=this,b.__super__.constructor.apply(this,arguments)}return B(b,a),b.prototype.moduleType="app",b}(a.View),a.Model=function(b){function d(b,e){var f,g,h,i=this;null==b&&(b={}),null==e&&(e={}),null==this.name&&(this.name=this.constructor.name),h=_.extend(e.compute||{},this.compute);for(f in h)g=h[f],this.computeProperty(f,g);null==this.relations&&(this.relations={}),this.relations.$state=a.State,this._mapRelations(_.extend({},this.relations,e.relations)),d.__super__.constructor.apply(this,arguments),c(this),a.config.debug.logModelChanges&&this.on("change",function(){var a;try{return console.log(JSON.stringify(i.toJSON(),null,2))}catch(b){return a=b,console.log(a)}})}return B(d,b),d.prototype.destroy=function(){return this.off(),this.stopListening(),d.__super__.destroy.apply(this,arguments)},d.prototype.blacklist=[],d.prototype._mapRelations=function(a){var c,d,e,f;if(null==a&&(a=this.relations),null==this.defaults&&(this.defaults={}),a&&!_.isArray(a)){e=[];for(d in a){for(f=a[d],c=!1,b=f;b=b.__super__;)b===Backbone.Collection.prototype&&(c=!0);e.push({key:d,type:c?"Many":"One",collectionType:c?f:void 0,relatedModel:c?f.prototype.model:f})}return this.relations=e}},d.prototype.toJSON=function(a){var b;return b=Backbone.AssociatedModel.prototype.toJSON.call(this),a?b:_.omit(b,this.blacklist)},d.prototype.computeProperty=function(a,b){var c,d,e,f,g,h,i=this;switch(b=_.clone(b),$.type(b)){case"object":d=b;break;case"array":d={fn:b.pop(),triggers:b}}for(this.blacklist.push(a),c=function(){var b,c;return c=d.triggers.map(function(a){return i.get(a)}),b=d.fn.apply(i,c),i.set(a,b)},h=d.triggers,f=0,g=h.length;g>f;f++)e=h[f],this.on("change:"+e,c);try{return c()}catch(j){}},d.prototype.toggle=function(a){return this.set(a,!this.get(a))},d.prototype.moduleType="model",d}(Backbone.AssociatedModel),a.State=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.parent=this.parents[0],null==this.name&&(this.name=this.constructor.name),this.parent&&this.on("all",function(){var a=this;return function(){var b,c;return c=arguments[0],b=2<=arguments.length?C.call(arguments,1):[],a.parent.trigger.apply(a.parent,["state:"+c].concat(b))}})}return B(b,a),b}(a.Model),a.Router=function(a){function b(){null==this.name&&(this.name=this.constructor.name),c(this),b.__super__.constructor.apply(this,arguments)}return B(b,a),b.prototype.destroy=function(){return this.off(),this.stopListening()},b.prototype.moduleType="router",b}(Backbone.Router),a.Collection=function(b){function d(){d.__super__.constructor.apply(this,arguments),null==this.name&&(this.name=this.constructor.name),c(this)}return B(d,b),d.prototype.destroy=function(){return this.off(),this.stopListening()},d.prototype.model=a.Model,d.prototype.moduleType="collection",d}(Backbone.Collection),a.Singleton=function(a){function b(){var a=this;b.__super__.constructor.apply(this,arguments),this.on("all",function(){var b,c;return c=arguments[0],b=2<=arguments.length?C.call(arguments,1):[],g?g.trigger.apply([""+a.name+":"+c].concat(b)):void 0})}return B(b,a),b}(a.Model),a.List=function(){function a(a,b){null==b&&(b={}),this.reset(a,b)}return a.prototype.unshift=function(){var a,b,c,d,e,f;for(b=1<=arguments.length?C.call(arguments,0):[],e=b.reverse(),f=[],c=0,d=e.length;d>c;c++)a=e[c],f.push(this.add(a,{at:0}));return f},a.prototype.push=function(){var a,b,c,d,e;for(b=1<=arguments.length?C.call(arguments,0):[],e=[],c=0,d=b.length;d>c;c++)a=b[c],e.push(this.add(a,{at:this.length}));return e},a.prototype.shift=function(){return this.remove(null,{at:0})},a.prototype.pop=function(){return this.remove(null,{at:this.length-1})},a.prototype.reset=function(a,b){return null==b&&(b={}),this.splice(this.length,this.length),this.push.apply(this,a),b.silent?void 0:this.trigger("reset",this,b)},a.prototype.add=function(a,b){var c;return null==b&&(b={}),c=null!=b.at?b.at:b.at=this.length,this.splice(c,null,a),b.silent?void 0:this.trigger("add",a,this,b)},a.prototype.remove=function(a,b){var c;return null==b&&(b={}),c=b.at||this.indexOf(a),null==a&&(a=this[c]),this.splice(c,1),b.silent||this.trigger("remove",a,this,b),a},a}(),_.extend(a.List.prototype,Backbone.Events),w=["splice","indexOf","lastIndexOf","join","reverse","sort","valueOf","map","forEach","every","reduce","reduceRight","filter","some"],m=0,q=w.length;q>m;m++)h=w[m],a.List.prototype[h]||(a.List.prototype[h]=d[h]);for(x=["each","contains","find","filter","reject","contains","max","min","sortBy","groupBy","sortedIndex","shuffle","toArray","size","first","last","initial","rest","without","isEmpty","chain","where","findWhere","clone","pluck","invoke"],n=0,r=x.length;r>n;n++)h=x[n],a.List.prototype[h]||(a.List.prototype[h]=_[h]);for(a.Object=function(){function a(){}return a}(),_.extend(a.prototype,Backbone.Events),b=function(a){function b(a){var c,d,e,f=this;null==a&&(a={}),null==this.name&&(this.name=a.name||(a.model&&a.model.name?a.model.name+":view":void 0)),e=a.view,d=a.html,c=a.data,this.ractive=!!e.ractive,a.path&&(this.relations={model:e.get(a.path).model}),null==this.template&&(this.template=d),b.__super__.constructor.apply(this,arguments),a.model&&this.set("model",a.model),d&&this.set("html",d),this.ractive?this.render():this.$el.html(d),c&&(c.toJSON?(this.set(c.toJSON()),this.listenTo(c,"all",function(a){var b,d,e;return e=a.split(":"),b=e[0],d=e[1],"change"===b&&d?f.set(keyPath,c.get(keyPath)):void 0})):this.set(c))}return B(b,a),b}(a.View),e=function(a){return a[0].toUpperCase()+a.substring(1)},c=function(b){var c;return b instanceof a.State?void 0:(c=b.state,null==b.blacklist&&(b.blacklist=[]),b.blacklist.push("$state"),b instanceof a.Collection||b.set("$state",c),b.state=b.get("$state"),b.state||(b.state=new a.State(c)),b.state.on("all",function(){var a,c,d;return c=arguments[0],a=2<=arguments.length?C.call(arguments,1):[],d=c.split(":"),"change"===d[0]&&d[1]?b.trigger.apply(["change:$state."+d[1]].concat(a)):void 0}))},a.components={collection:function(a,c,d){var e,f,g,h,i,j=this;return i=d.path||d.collection,h=d.name,e=pict.views[pict.utils.capitalize(d.view)]||b,f=a.html(),a.empty(),g=function(b){return j.insertView(a,new e(_.extend({data:b,html:f,view:c,name:h,path:i,model:b},d)))},this.on("reset:"+i,function(){var a,b,d,e,f;for(e=j.childViews(c),f=[],b=0,d=e.length;d>b;b++)a=e[b],f.push(a.destroy());return f}),this.on("remove:"+i,function(a){return j.childView({model:a}).destroy()}),this.on("add:"+i,g),this.get(i).each(g)},view:function(a,c,d){var e,f,g,h;return e=pict.views[pict.utils.capitalize(d.view)]||b,h=d.name,f=this.get(d.data)||c.state,g=a.html(),a.empty(),this.insertView(a,new e(_.extend({html:g,view:c,name:h,data:f},d)))},log:function(a,b,c){var d,e,f;e={};for(d in c)f=c[d],e[d]=this.get(f);return console.log("x-log:",e),a.remove()},list:function(){}},a.plugins={view:{ractive:function(){},ouetlet:function(){var a=this;return this.on("after:render",function(){return a.$("[data-outlet]").each(function(b,c){var d,e;return d=$(c),e=d.attr("data-outlet"),a.$[e]=d,d.on("blur, focus, focusin, focusout, load, resize, scroll,            unload, click, dblclick, mousedown, mouseup, mousemove, mouseover,            mouseout, mouseenter, mouseleave, change, select, submit, keydown,            keypress, keyup, error, touchstart, touchend, touchmove",function(b){return a.trigger([event.type,e].join(":"),b)})})}),null==this.foo&&(this.foo=function(){}),null==this.bar&&(this.bar=function(){}),{foo:function(){},bar:function(){}}},foobar:{init:function(){},foo:function(){},bar:function(){}}},all:{state:function(){}}},a.filters={uncapitalize:function(a){return a&&a[0].toLowerCase()+a.substring(1)||""},capitalize:function(a){return a&&a[0].toUpperCase()+a.substring(1)||""},uppercase:function(a){return a.toUpperCase()},lowercase:function(a){return a.toLowerCase()},json:function(a){return JSON.stringify(a,null,2)},orderBy:function(a,b,c){return a=a.sort(function(a){return a[b]}),c?a.reverse():a}},a.setup={all:{plugins:{state:!0}},view:{plugins:{outlets:!0,filters:!0,ractive:!0,components:!0,manage:!0,eventSugar:!0}},model:{plugins:{}},router:{plugins:{}},collection:{plugins:{}}},y=["Model","Router","Collection","View"],o=0,s=y.length;s>o;o++)for(f=y[o],z=["get","set","on","listenTo","off","stopListening","once","listenToOnce","trigger","clear","has","invert","omit","pick","sync","fetch","save","changed","validate","isValid","clone","hasChanged","previous","destroy"],k=function(b){return a[f].prototype["state"+e(b)]=function(){var a;return a=1<=arguments.length?C.call(arguments,0):[],this.state[b].apply(this.state,a)}},u=0,t=z.length;t>u;u++)h=z[u],k(h);a.Controller=a.View,window.Base=a}.call(this);